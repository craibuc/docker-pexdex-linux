# Command-line Interface (Java)

## Usage

-  Must run the JAR from the provided `runtime/bin` folder within your installation directory.
-  The usage information of the command-line tool is as below:

```bash
pexdexCLI [-c] [-d] [-f <arg>] [-i <arg>] [-k <arg>] [-p <arg>] [-r] [-s] [-t <arg>] [-v]
```

Where the definitions for the switches is as follows:

Switch|Description
---|---
`-r,--register`|Register the site. requires - siteId and emailId
`-c,--confirmregister`|Confirm Register the site. requires - siteId, PIN and sftp certificate
`-v,--validate`|Validate the xml against pedscreen XSD. require -XML file path 
`-d,--deidentify`|Deidentify the XML. require - XML file path, the pid.txt file path, SubmissionType, SiteId
`-s,--submit`|Submit the deid file to Utah DCC. require siteId, the SubmissionFile.xml path.  It's generated within the Xmlfolder generated by pexdex app.
`-f,--file <arg>`|The XML filepath for validate or deid options
`-i,--siteid <arg>`|Four letter SiteId for the site
`-k,--publickey <arg>`|SFTP Public key
`-p,--pin <arg>`|Four-digit PIN sent via email from Utah DCC
`-t,--pidtxt <arg>`|The PID text filepath for deid options
`-e,--emailAddress <arg>`|Email address
`-y,--submissionType <arg>`|SubmissionType can be 0 for NoDeid and 1 for Deid submissions
`-v,--verbose`|Verbose messages

- The operations register, confirm register, validate, deidentify and submit needs to be done in a sequential order.
- After the first register and confirm register step, do not do them again unless you want to create a registration for another site.
- Only in case you want to create a registration for another site in the same machine, choose another site and repeat the register and confirm register steps.

## Examples

In the examples, the following for `pexdexCLI`:

```bash
java "-Dproperties.dir=C:\Program Files\PEXDEX" -jar .\CLI\pexdexCLI.jar --spring.profiles.active=error
```

Examples must be executed from the `C:\Program Files\PEXDEX` directory.

### Register
Registers an email address for a site.
```bash
pexdexCLI --register --siteid <arg> --study [pedscreen|registry] --emailAddress <arg>
```

### Confirm Registration
Confirms the registration once PIN has been received.
```bash
pexdexCLI --confirmregister --siteid <arg> --study [pedscreen|registry] --pin <arg> --publickey <arg>
```

### Validate XML
Validates the XML file against pedscreen XSD schema file.
```bash
pexdexCLI --validate --siteid <arg> --study [pedscreen|registry] --file <arg>
```

### De-identify
Deidentifies the XML file.
```bash
pexdexCLI --deidentify --siteid <arg> --study [pedscreen|registry] --submissionType [0|1] --file <arg> --pidtxt <arg>
```

> NOTE: 0 = do not de-identify; 1 = de-identified

### Submit
Submit the de-identified file to Utah DCC. require siteId, the SubmissionFile.xml path.  Its generated within the Xmlfolder generated by pexdex app.
```bash
pexdexCLI --submit --siteid <arg> --study [pedscreen|registry] --file <arg>
```

## Directory Structure

Directory|Significance
---|---
C:\Program Files\PEXDEX|contains PexDex-related files
C:\Program Files\PEXDEX\runtime|Java binary files
C:\Program Files\PEXDEX\strawberry|Perl location
C:\Program Files\PEXDEX\CLI\pexdexCLI.jar|The JAR that contains PexDex's CLI
C:\Program Files\PEXDEXpexdex-cli.properties|CLI-related settings
C:\Users\PROFILE_NAME\AppData\Roaming\pexdex|user-specific, PexDex settings
C:\Users\PROFILE_NAME\AppData\Roaming\pexdex\perl|`de-id` application
C:\Users\PROFILE_NAME\AppData\Roaming\pexdex\perl\lists|name files;doctor_first_names.txt,doctor_last_names.txt,female_names_ambig.txt,last_names_ambig.txt,male_names_ambig.txt copied to this directory
C:\Users\PROFILE_NAME\AppData\Roaming\pexdex\registry.*|directories that contain public-key/private-key pairs for each location being submitted
